# -*- coding: utf-8 -*-
"""topsis

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zWdnDhKjU_bR0EMh9NT91VC7HJ1pEp8v
"""

import sys
import pandas as pd
import numpy as np
import os

def run_topsis(infile, w_str, im_str, outfile):

    if not os.path.isfile(infile):
        print("Error: File not found")
        return

    try:
        df = pd.read_csv(infile)
    except:
        print("Error: Cannot read input file")
        return

    if df.shape[1] < 3:
        print("Error: Minimum three columns required")
        return

    try:
        data = df.iloc[:, 1:].astype(float)
    except:
        print("Error: Non numeric values present")
        return

    w = w_str.split(',')
    im = im_str.split(',')

    if len(w) != data.shape[1] or len(im) != data.shape[1]:
        print("Error: Weights or impacts count mismatch")
        return

    try:
        w = np.array(w, dtype=float)
    except:
        print("Error: Weights must be numeric")
        return

    for x in im:
        if x != '+' and x != '-':
            print("Error: Impacts must be + or -")
            return

    norm = data / np.sqrt((data ** 2).sum())
    wdata = norm * w

    best = []
    worst = []

    for i in range(len(im)):
        if im[i] == '+':
            best.append(wdata.iloc[:, i].max())
            worst.append(wdata.iloc[:, i].min())
        else:
            best.append(wdata.iloc[:, i].min())
            worst.append(wdata.iloc[:, i].max())

    best = np.array(best)
    worst = np.array(worst)

    dp = np.sqrt(((wdata - best) ** 2).sum(axis=1))
    dn = np.sqrt(((wdata - worst) ** 2).sum(axis=1))

    score = dn / (dp + dn)

    df["Topsis Score"] = score
    df["Rank"] = score.rank(ascending=False, method="dense").astype(int)

    df.to_csv(outfile, index=False)
    print("Output saved to", outfile)


def main():
    if len(sys.argv) != 5:
        print("Usage: python topsis.py <InputDataFile> <Weights> <Impacts> <OutputFile>")
        return

    run_topsis(sys.argv[1], sys.argv[2], sys.argv[3], sys.argv[4])


if __name__ == "__main__":
    main()